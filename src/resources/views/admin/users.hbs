<style>
    .list-group-item:nth-child(even) {
        background-color: #e8f4ec;
    }
</style>

<center class="mb-5">
    <h1><b>Danh sách người dùng đăng ký</b></h1>

</center>

<div class="row justify-content-center mb-5 ">
    <div class="col-md-6 shadow-p bg-body-tertiary rounded-5 bg-light">
        <form method="GET" action="nguoi-dung" class="container my-3">
            <div class="row g-2">
                <div class="col-12 col-md-9">
                    <input type="text" name="search" value="{{search}}" placeholder="Tìm theo tên..."
                        class="form-control rounded-pill" />
                </div>
                <div class="col-12 col-md-3">
                    <button class="btn btn-primary rounded-pill w-100" type="submit">Tìm kiếm</button>
                </div>
            </div>
        </form>
    </div>
</div>

<div class="row justify-content-center mb-5">
    <div class="col-md-11">
        <ul class="list-group list-group-flush">
            {{#each users}}
            <li class="list-group-item">
                <div
                    class="align-items d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
                    <div>
                        {{this.name}}
                    </div>
                    <div>
                        <i class="bi bi-telephone-fill"></i>
                        {{this.phone}}
                    </div>
                    <div>
                        <i class="bi bi-envelope-fill"></i>
                        {{this.email}}
                    </div>
                    <div>
                        {{#unless this.approved}}
                        <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal"
                            data-bs-target="#approveModal" data-id="{{this._id}}">
                            Cấp tài khoản
                        </button>
                        {{/unless}}
                        <button id="btn-delete-user" type="button" class="btn btn-outline-danger" data-bs-toggle="modal"
                            data-bs-target="#deleteModal" data-id="{{this._id}}">
                            Xóa
                        </button>
                    </div>
                </div>
            </li>
            {{/each}}
        </ul>
    </div>
</div>

<!--Delete  Modal -->
<div class="modal fade" id="deleteModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="staticBackdropLabel">Xóa người dùng</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Bạn có chắc chắn muốn xóa không?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                <button id="btnDeleteUser" type="button" class="btn btn-danger">Xóa</button>
            </div>
        </div>
    </div>
</div>

<!--Approve  Modal -->
<div class="modal fade" id="approveModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="staticBackdropLabel" name="user">Cấp tài khoản cho người dùng </h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="approveUserForm" method="POST">
                    <!-- Tài khoản -->
                    <div class="mb-3">
                        <label for="account" class="form-label">Tài khoản:</label>
                        <input type="text" id="account" name="account" class="form-control" placeholder="Nhập tài khoản"
                            required>
                    </div>
                    <!-- Mật khẩu -->
                    <div class="mb-3">
                        <label for="password" class="form-label">Mật khẩu:</label>
                        <input type="text" id="password" name="password" class="form-control"
                            placeholder="Nhập mật khẩu" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                <button id="btnApproveUser" type="button" class="btn btn-primary">Cấp tài khoản</button>
            </div>
        </div>
    </div>
</div>



<!--Delete form -->
<form id="deleteUserForm" method="POST" action=""></form>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var userId;

        $('#deleteModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget);
            userId = button.data('id');
        });

        $('#approveModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget);
            userId = button.data('id');
        });

        btnDeleteUser.onclick = function () {
            deleteUserForm.action = '/admin/nguoi-dung/delete/' + userId;
            deleteUserForm.submit();
        };

        btnApproveUser.onclick = function () {
            approveUserForm.action = '/admin/nguoi-dung/approve/' + userId;
            approveUserForm.submit();
        };
    });

</script>